head	1.3;
access;
symbols;
locks; strict;
comment	@# @;


1.3
date	2008.06.09.13.11.53;	author root;	state Exp;
branches;
next	1.2;

1.2
date	2008.06.07.19.53.30;	author root;	state Exp;
branches;
next	1.1;

1.1
date	2008.06.07.17.39.26;	author root;	state Exp;
branches;
next	;


desc
@@


1.3
log
@fixed up some echoing.
@
text
@# $Header: /usr/local/sbin/gentoo.periodic/modules/RCS/ssh_login.sh,v 1.2 2008/06/07 19:53:30 root Exp root $
#
# ssh_login.sh - find unsuccessful and successful logins 

AUTH_LOGS="/var/log/auth.log /var/log/auth.log.0"
TODAY=`date --date=yesterday "+%b %_d"`
TMP_FILE="/tmp/$$.login_check.tmp"

cat $AUTH_LOGS | fgrep "$TODAY" > $TMP_FILE 

# find successful logins
echo " * Sucessful logins." 
fgrep "Accepted keyboard-interactive" $TMP_FILE
echo ""
# find all good suid attempts
echo " * Sucessful SUID logins."
fgrep "Successful su for root by " $TMP_FILE 
echo "" 
# find unsuccessful logins
echo " * Unucessful attempted logins." 
fgrep "Invalid user " $TMP_FILE
echo "" 
# find all bad suid attempts
echo " * Unsucessful SUID attempts." 
fgrep "FAILED su for" $TMP_FILE
echo ""

# find possible sshd scanners
echo " * Possible sshd scanners" 
fgrep "POSSIBLE BREAK-IN ATTEMPT!" $TMP_FILE 
echo ""

if [[ -e $TMP_FILE ]]; then 
	rm $TMP_FILE
fi

@


1.2
log
@first run.
@
text
@d1 1
a1 1
# $Header: /usr/local/sbin/gentoo.periodic/modules/RCS/ssh_login.sh,v 1.1 2008/06/07 17:39:26 root Exp root $
d9 1
a9 1
cat $AUTH_LOGS | fgrep '$TODAY' > $TMP_FILE 
d14 1
d18 1
a18 1

d22 1
d26 2
d31 1
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $Header$
d5 5
a9 2
AUTH_LOG="/var/log/auth.log.0"
TODAY=`date +%b %d`
d12 5
a16 1
fgrep "Accepted keyboard-interactive"
d18 3
a20 1
# find all good suid attempts
d22 10
a31 1
grep "FAILED\ su\ for\|
@
